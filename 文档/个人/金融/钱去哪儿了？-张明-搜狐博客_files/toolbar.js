/*! SohuBlog @snandy 2013-07-03 16:47:45 */
function getUserAgent(){var t=navigator.userAgent.toLowerCase();if(t.indexOf("opera")>=0)return"opera";if(t.indexOf("firefox")>=0)return"ff";if(t.indexOf("gecko")>=0)return"moz";if(t.indexOf("msie")){if(ieVer=parseFloat(t.substr(t.indexOf("msie")+5)),ieVer>=6)return"ie6";if(ieVer>=5.5)return"ie55";if(ieVer>=5)return"ie5"}return"other"}function getFullUrl(t){return 0==t.indexOf("http://")||0==t.indexOf("https://")?t:0==t.indexOf("/")?location.protocol+"//"+location.host+t:0==t.indexOf("www")?"http://"+t:location.href.substr(0,location.href.lastIndexOf("/")+1)+t}function drawAppInfo(t){if(t=t||document.getElementById(t)){var e="";e+='<div id="login_ico"><a href="'+ToolBar.getEditProfilePath()+'" target="_blank" onmousedown="CA.q(\'toolbar_myPassport_icon\');"><img id="login_icoImg" src="'+ToolBar.getIco()+'" alt="修改档案" /></a></div>',e+='<p id="login_name">',e+=ToolBar.getN(),e+="</p>",e+='<div id="login_opr">',e+='<a href="'+ToolBar.getEditIconPath()+'" title="修改头像" target="_blank" onmousedown="CA.q(\'toolbar_myPassport_editIcon\');">修改头像</a>|',e+='<a href="'+ToolBar.getEditProfilePath()+'" title="修改档案" target="_blank" onmousedown="CA.q(\'toolbar_myPassport_editProfile\');">修改档案</a>|',e+='<a href="'+ToolBar.getBlogSettingPath()+'" title="博客设置" target="_blank" onmousedown="CA.q(\'toolbar_myPassport_blogSetting\');">博客设置</a>',e+="</div>",t.innerHTML=e}}function logoutApp(){if(ToolBar.clearUser(),"group"==ToolBar.pdt){var t=document.createElement("script");t.src="http://q.sohu.com/service/logout.jsp?noru",document.getElementsByTagName("head")[0].appendChild(t)}else if("blog"==ToolBar.pdt){var t=document.createElement("script");t.src="http://blog.sohu.com/logout.do?noru",document.getElementsByTagName("head")[0].appendChild(t)}}function $L(t){if("boolean"!=typeof window._canLog){if("function"!=typeof getCookie)return;window._canLog=!!getCookie("b_l")}window._canLog&&(window.console?console.log(t):"function"==typeof $LR&&$LR(t))}function shareIt(t){var e=Attr.exp(t,"url");-1==e.indexOf("http://")&&(e=_blog_base_url+e.replace("/",""));var i="http://i.sohu.com/a/app/mblog/add.htm?link="+e+"&"+"title="+escape(Attr.exp(t,"title"));i=i.replace(/%A0/g,"%20"),window.open(i,"_blank","width=570,height=351")}function createShareMenu(t){var e="popLay",i="shareMenu1";2==t&&(e="popLay popshow1",i="shareMenu2");var s=new Element("div",{"class":e,id:i});return str='<div class="popUp"><ul>',2==t&&(str+=' <li><a href="javascript:void(0)" onclick="shareTo(\'mini\')"><i class="i-tBlog"></i><span>搜狐微博</span></a></li>'),str+='<li><a href="javascript:void(0)" onclick="shareTo(\'blog\')"><i class="i-sBlog"></i><span>搜狐博客</span></a></li><li><a href="javascript:void(0)" onclick="shareTo(\'bai\')"><i class="i-sBai"></i><span>白社会</span></a></li><li><a href="javascript:void(0)" onclick="shareTo(\'kaixin\')"><i class="i-kaixin"></i><span>开心网</span></a></li><li><a href="javascript:void(0)" onclick="shareTo(\'renren\')"><i class="i-renren"></i><span>人人网</span></a></li><li><a href="javascript:void(0)" onclick="shareTo(\'douban\')"><i class="i-douban"></i><span>豆瓣网</span></a></li></ul></div><div class="popShade"></div><div class="popMask"></div>',s.innerHTML=str,s.hide(),$("shareMenuLayer")?$("shareMenuLayer").insert(s):document.body.insert(s),Event.observe(document,"click",function(e){Event.element(e)==s||Element.childOf(Event.element(e),s)||(s.hide(),$("shareMenuButton"+t).removeClassName("act"))}),s}function showShareMenu(t,e){e||(e=1);var i=$("shareMenu"+e);i||(i=createShareMenu(e));var s=20,o=0;2==e&&(s=13,o=-2);var n=$("shareMenuButton"+e);i&&(i.visible()?(n.removeClassName("act"),i.hide()):(Position.clone(n,i,{setLeft:!0,setTop:!0,setWidth:!1,setHeight:!1,offsetTop:s,offsetLeft:o}),i.show(),Event.stop(t),n.addClassName("act")))}function shareTo(t){var e=$("shareMenuButton1"),i=650,s=423;switch(t){case"blog":var o="http://share.blog.sohu.com/submit.jhtml?shareType="+Attr.exp(e,"shareType")+"&"+"url="+Attr.exp(e,"url")+"&"+"title="+escape(Attr.exp(e,"title"))+"&"+"abstracts="+escape(Attr.exp(e,"abstracts"))+"&"+"ext="+escape(Attr.exp(e,"ext"));break;case"mini":var o="http://t.sohu.com/third/post.jsp?url="+Attr.exp(e,"url")+"&"+"title="+encodeURIComponent(Attr.exp(e,"title"))+"&"+"detail="+encodeURIComponent(Attr.exp(e,"abstracts"));i=650,s=423;break;case"bai":var o="http://bai.sohu.com/share/blank/addbutton.do?from=&link="+Attr.exp(e,"url")+"&title="+escape(Attr.exp(e,"title"));i=633,s=423;break;case"kaixin":var o="http://www.kaixin001.com/repaste/share.php?rtitle="+escape(Attr.exp(e,"title"))+"&rurl="+Attr.exp(e,"url")+"&rcontent="+escape(Attr.exp(e,"abstracts"));i=633,s=423;break;case"renren":var o="http://share.renren.com/share/buttonshare.do?link="+Attr.exp(e,"url")+"&title="+escape(Attr.exp(e,"title"));i=633,s=423;break;case"douban":var o="http://www.douban.com/recommend/?url="+Attr.exp(e,"url")+"&title="+encodeURIComponent(Attr.exp(e,"title"));i=633,s=423}o=o.replace(/%A0/g,"%20"),window.open(o,"_blank","width="+i+",height="+s+",scrollbars=yes")}function shareMe(t){var e=["shareType","url","title","abstracts","ext"],i={shareType:"",url:location.href,title:document.title,abstracts:"",ext:""},s={abstracts:100},o="http://share.blog.sohu.com/submit.jhtml?"+getAttrData(t,e,i,s,"data-share-").join("&");window.open(o,"_blank","width=530,height=301")}function getAttrData(ele,keys,dData,limit,attrPrefix){for(var params=[],i=0,il=keys.length;il>i;i++){var it=keys[i],v=ele.getAttribute(it),value="";if((v=ele.getAttribute(attrPrefix+it))&&"string"==typeof v&&v.length>0&&(v=v.split("+")))for(var j=0,jl=v.length;jl>j;j++){var arr=v[j].split("|"),expType=arr[0],expValue=arr[1];switch(expType){case"S":value+=expValue;break;case"V":expValue=expValue.split(".");for(var tempV=window,k=0,kl=expValue.length;kl>k;k++)if(!(tempV=tempV[expValue[k]])){tempV="";break}value+=tempV;break;case"E":var eles=expValue.split("@"),eleName=eles[0],eleAttr=eles[1],eleNow=null;if(eles[0]){var eleType=eleName.charAt(0);switch(eleName=eleName.substring(1,eleName.length),eleType){case"#":eleNow=$(eleName)}}else eleNow=ele;if(eleNow){var tempVa;"innerHTML"==eleAttr?(tempVa="string"==typeof eleNow.innerText?eleNow.innerText:eleNow.innerHTML.unescapeHTML())&&(tempVa=tempVa.replace(/\r|\n/gm,""))&&(tempVa=tempVa.trim())||(tempVa=""):tempVa=eleNow.getAttribute(eleAttr)||"",value+=tempVa}break;case"F":value+=eval("("+expValue+")")}}value=value||dData[it],limit[it]&&value.length>limit[it]&&(value=value.substr(0,limit[it])),params.push(it+"="+escape(value))}return params}function pokeMe(t,e,i){var s=t?i===void 0?"actId=1&":"actId="+i+"&":"",o="http://poke.blog.sohu.com/pop/poking.do?"+s+"xpt="+e;window.open(o,"_blank","width=630,height=470")}function pokeHe(t){window.open("http://poke.blog.sohu.com/pop/poking.do?actId=1&pp="+t,"_blank","width=630,height=470")}function _gw(){var t=_w,e=_w.c,i=10*Math.random();i>=0&&_p>=i&&(t=_a,e=_a.c);var e=_gl(t,e);return 0==e.length?(e=_gl(_w,_w.c),e[Math.floor(Math.random()*e.length)]):e[Math.floor(Math.random()*e.length)]}function _gl(t,e){var i=new Date,s=i.getHours(),o=i.getDay();return s>=6&&9>s&&(e=e.concat(t.m)),s>=9&&12>s&&(e=e.concat(t.a)),s>=12&&14>s&&(e=e.concat(t.n)),s>=14&&17>s&&(e=e.concat(t.p)),s>=17&&19>s&&(e=e.concat(t.d)),s>=19&&21>s&&(e=e.concat(t.e)),s>=21&&24>s&&(e=e.concat(t.l)),s>=0&&6>s&&(e=e.concat(t.w)),(0==o||6==o)&&(e=e.concat(t.k)),e}if(Browser===void 0||!Browser){var Browser={};Browser.ua=getUserAgent()}var WinMenus={wMenus:[],register:function(t){this.wMenus.push(t)},unregister:function(t){this.wMenus=this.wMenus.reject(function(e){return e==t})}},WinMenu=Class.create();if(WinMenu.prototype={initialize:function(t){this.options=Object.extend({menuData:[],elm_extendTop:null,elm_extendBottom:null,title:null,clsBtn:!0,shadow:!0,shadowOffset:4,dragable:!1,placeIn:document.body,click2cls:!0,autoCls:!1,autoActive:!0,btn:null,displace:[],ableExpandSubmenu:!0,noneInfo:"undefined"!=typeof App?App.Lang.none:"",zIndex:500,allInOne:!1,menuType:"expand",onShow:null,onHide:null,sDivCss:"menuSub-div",imtDivCss:"subMenu-maintitle",imcDivCss:"subMenu-content",itDivCss:"subMenu-title",isDivCss:"menuInnerSub-div",sOutCss:"menuSub-out",sOverCss:"menuSub-over",sDownCss:"menuSub-down",sDisableCss:"menuSub-disabled",sActiveCss:"menuSub-active",Lang:{close:"undefined"!=typeof App?App.Lang.close:"close",loading:"undefined"!=typeof App?App.Lang.loading:"loading"}},t||{}),this.buildWin(),WinMenus.register(this),this.eventCancelBubble=Event.stop.bindAsEventListener(this),this.options.autoCls&&Event.observe(this.options.btn,"click",this.eventCancelBubble)},destroy:function(){Element.remove(this.element),WinMenus.unregister(this)},buildWin:function(){var t=document.createElement("div");this.elm_subMenu=t;var e=[],i=[];this.options.menuData.each(function(t){var s=this.options.itDivCss,o="";t.itDivExtCss&&(s+=" "+t.itDivExtCss),this.options.ableExpandSubmenu&&(s+=" ",t.active?s+=this.options.itDivCss+"-active":(s+=this.options.itDivCss+"-out",o+=' style="display:none;"')),e.push('<div class="'+s+' clearfix"'+(t.title?"":' style="display:none"')+">"),e.push(t.title),e.push("</div>"),i.push('<div class="'+this.options.isDivCss+' clearfix"'+o+">"),i.push(this.options.Lang.loading),i.push("</div>"),t.more&&i.push(t.more),"expand"==this.options.menuType&&(e=e.concat(i),i=[])}.bind(this)),t.innerHTML=e.join("")+i.join(""),this.elm_subTitles=document.getElementsByClassName(this.options.itDivCss,t,"div"),this.elm_subConts=document.getElementsByClassName(this.options.isDivCss,t,"div"),this.options.ableExpandSubmenu&&$A(this.elm_subTitles).each(function(t,e){var i=t;Event.observe(i,"click",function(){"tab"==this.options.menuType&&this.hideSbuContentOther(e),"none"==this.elm_subConts[e].style.display?(Element.show(this.elm_subConts[e]),Element.removeClassName(i,this.options.itDivCss+"-out"),Element.addClassName(i,this.options.itDivCss+"-active"),this.elm_subConts[e].innerHTML==this.options.Lang.loading&&setTimeout(this.buildSubContent.bind(this,e),10)):"tab"!=this.options.menuType&&(Element.hide(this.elm_subConts[e]),Element.removeClassName(i,this.options.itDivCss+"-active"),Element.addClassName(i,this.options.itDivCss+"-out"))}.bind(this)),Event.observe(i,"mouseover",function(){Element.addClassName(i,this.options.itDivCss+"-over")}.bind(this)),Event.observe(i,"mouseout",function(){Element.removeClassName(i,this.options.itDivCss+"-over")}.bind(this))}.bind(this));var s=Object.extend({},this.options);Object.extend(s,{content:[this.options.elm_extendTop,t,this.options.elm_extendBottom],position:function(){var t=Position.cumulativeOffset(this.options.btn);return t=[t[0]+(this.options.displace[0]||0),t[1]+(this.options.displace[1]||0)+parseInt(this.options.btn.offsetHeight)+2]}.bind(this)}),this.win=new Win(s),setTimeout(this.buildSubContent.bind(this,0),10)},updateMenuData:function(t){this.options.menuData=t,this.updateSubContent(0)},buildSubContent:function(t){isNaN(t)||this.options.menuData[t]&&this.elm_subConts[t]&&("none"!=this.elm_subConts[t].style.display&&this.elm_subConts[t].innerHTML==this.options.Lang.loading&&this.doBuildSubContent(t),this.options.menuData.length-1>t&&setTimeout(this.buildSubContent.bind(this,t+1),10))},updateSubContent:function(t){isNaN(t)||this.options.menuData[t]&&this.elm_subConts[t]&&(this.elm_subConts[t].innerHTML!=this.options.Lang.loading&&this.doBuildSubContent(t),this.options.menuData.length-1>t&&setTimeout(this.updateSubContent.bind(this,t+1),10))},doBuildSubContent:function(t){if(this.options.menuData[t].data.constructor==Array)var e=this.getSubContent(t);else if(this.options.menuData[t].data.constructor==Function)var e=this.options.menuData[t].data(t);"none"==this.elm_subConts[t].style.display&&Element.hide(e),""==e.innerHTML&&(e.innerHTML=this.options.noneInfo),this.elm_subConts[t].parentNode.insertBefore(e,this.elm_subConts[t]),Element.remove(this.elm_subConts[t]),this.elm_subConts[t]=e},getSubContent:function(t){sm=this.options.menuData[t];var e=document.createElement("div");return e.className=this.options.isDivCss+" clearfix",sm.isDivCssEx&&Element.addClassName(e,sm.isDivCssEx),sm.data.each(function(i,s){var i={text:i.text||"",title:i.title||"",action:i.action||Prototype.emptyFunction,value:i.value||!isNaN(i.value)?i.value:null,active:i.active||!1,disabled:i.disabled||!1},o=document.createElement("div");o.className=this.options.sOutCss,i.active&&Element.addClassName(o,this.options.sActiveCss),i.disabled&&Element.addClassName(o,this.options.sDisableCss),o.innerHTML=i.text,i.text&&(o.title=i.title||i.text),Event.observe(o,"mouseover",function(){i.disabled||Element.addClassName(o,this.options.sOverCss)}.bind(this)),Event.observe(o,"mouseout",function(){i.disabled||(Element.removeClassName(o,this.options.sOverCss),Element.removeClassName(o,this.options.sDownCss))}.bind(this)),Event.observe(o,"mousedown",function(){i.disabled||Element.addClassName(o,this.options.sDownCss)}.bind(this)),Event.observe(o,"mouseup",function(){i.disabled||Element.removeClassName(o,this.options.sDownCss)}.bind(this)),Event.observe(o,"click",function(){i.disabled||(this.options.autoActive&&this.activeItem(t,s),i.action(i.value),this.options.click2cls&&this.hide())}.bind(this)),e.appendChild(o)}.bind(this)),e},show:function(){this.win.show()},hide:function(){this.win.hide()},showSubContentOther:function(t){$A(this.elm_subTitles).each(function(e,i){if("none"!=this.elm_subConts[i].style.display||i==t)throw $continue;Element.removeClassName(e,this.options.itDivCss+"-out"),Element.addClassName(e,this.options.itDivCss+"-active")}.bind(this)),$A(this.elm_subConts).each(function(e,i){if("none"!=e.style.display||i==t)throw $continue;Element.show(e),e.innerHTML==this.options.Lang.loading&&setTimeout(this.buildSubContent.bind(this,i),10)}.bind(this))},hideSbuContentOther:function(t){$A(this.elm_subTitles).each(function(e,i){if("none"==this.elm_subConts[i].style.display||i==t)throw $continue;Element.removeClassName(e,this.options.itDivCss+"-active"),Element.addClassName(e,this.options.itDivCss+"-out")}.bind(this)),$A(this.elm_subConts).each(function(e,i){if("none"==e.style.display||i==t)throw $continue;Element.hide(e)}.bind(this))},activeItem:function(t,e){$A(this.elm_subConts).each(function(i,s){if(!this.options.allInOne&&s!=t)throw $continue;if(i.innerHTML==this.options.Lang.loading)throw $continue;$A(document.getElementsByClassName(this.options.sOutCss,i,"div")).each(function(i,o){if(!i)throw $break;Element.removeClassName(i,this.options.sActiveCss),t==s&&e==o&&Element.addClassName(i,this.options.sActiveCss)}.bind(this))}.bind(this))}},Wins===void 0||!Wins){var Wins={wins:[],register:function(t){this.wins.push(t)},unregister:function(t){this.wins=this.wins.reject(function(e){return e==t})}},Win=Class.create();Win.prototype={initialize:function(t){this.options=Object.extend({content:null,title:null,clsBtn:!0,shadow:!0,shadowOffset:4,dragable:!1,placeIn:document.body,autoCls:!1,position:[],zIndex:500,okBtn:!1,cancelBtn:!1,onShow:null,onHide:null,onOk:null,onCancel:null,sDivCss:"menuSub-div",imtDivCss:"subMenu-maintitle",imcDivCss:"subMenu-content",imbDivCss:"subMenu-btnfield",Lang:{close:"undefined"!=typeof App?App.Lang.close:"close",loading:"undefined"!=typeof App?App.Lang.loading:"loading"}},t||{}),this.build(),Wins.register(this),this.eventCancelBubble=Event.stop.bindAsEventListener(this),this.options.autoCls&&Event.observe(document,"click",function(t){Event.element(t)==this.element||Element.childOf(Event.element(t),this.element)||this.hide()}.bindAsEventListener(this))},destroy:function(){Element.remove(this.element),Wins.unregister(this)},build:function(){var t=document.createElement("div");this.element=t,Element.hide(t);var e=[];if(e.push('<div class="'+this.options.sDivCss+'">'),(this.options.title||this.options.clsBtn)&&(e.push('<div class="'+this.options.imtDivCss+' clearfix">'),this.options.clsBtn&&e.push('<div class="cls" title="'+this.options.Lang.close+'"></div>'),this.options.title&&e.push(this.options.title),e.push("</div>")),e.push('<div class="'+this.options.imcDivCss+'">'),e.push("</div>"),(this.options.okBtn||this.options.cancelBtn)&&(e.push('<div class="'+this.options.imbDivCss+' clearfix">'),this.options.okBtn&&e.push('<input type="submit" class="button-submit" value="'+App.Lang.ok+'" />'),this.options.cancelBtn&&e.push('<input type="button" class="button" value="'+App.Lang.cancel+'" />'),e.push("</div>")),e.push("</div>"),this.element.innerHTML=e.join(""),this.elm_win=this.element.firstChild,this.options.title?(this.elm_tit=this.elm_win.childNodes[0],this.elm_con=this.elm_win.childNodes[1]):this.elm_con=this.elm_win.childNodes[0],this.options.clsBtn&&(this.elm_cls=this.elm_win.childNodes[0].firstChild,Event.observe(this.elm_cls,"click",function(){this.options.onCancel&&this.options.onCancel(),this.hide()}.bind(this))),this.options.okBtn||this.options.cancelBtn){var i=this.elm_win.childNodes[this.elm_win.childNodes.length-1];this.options.okBtn?(this.elm_ok=i.firstChild,this.elm_cancel=i.childNodes[1]):this.options.cancelBtn&&(this.elm_cancel=i.firstChild)}if(this.elm_ok&&this.options.onOk&&Event.observe(this.elm_ok,"click",function(){this.options.onOk(),this.hide()}.bind(this)),this.elm_cancel&&this.options.onCancel&&Event.observe(this.elm_cancel,"click",function(){this.options.onCancel(),this.hide()}.bind(this)),this.options.dragable){var s={starteffect:function(){},reverteffect:function(){},endeffect:function(){}};(this.options.title||this.options.clsBtn)&&(s.handle=this.options.imtDivCss),this.dragObj=new Draggable(this.element,s)}$(this.options.placeIn).appendChild(t),this.options.content&&(this.options.content.constructor!=Array?this.elm_con.appendChild(this.options.content):this.options.content.each(function(t){t&&this.elm_con.appendChild(t)}.bind(this)))},show:function(){if(!this.showing){if(this.element||this.build(),this.element.style.position="absolute",this.options.position&&"function"==typeof this.options.position)var t=this.options.position();else var t=this.options.position;this.element.style.width="10px",this.element.style.height="10px",this.element.style.left=t[0]+"px",this.element.style.top=t[1]+"px",this.element.style.zIndex=this.options.zIndex,this.elm_win.style.position="absolute",this.elm_win.style.left="0px",this.elm_win.style.top="0px",this.elm_win.style.zIndex=this.options.zIndex+10,0>Browser.ua.indexOf("ie")&&"undefined"!=typeof Effect&&Effect?(Effect.Appear(this.element,{from:0,to:.95,duration:.3,queue:{scope:"optMenu",position:"end"}}),setTimeout(this.showFrm.bind(this),400),this.options.shadow&&this.showShadow_2()):(Element.show(this.element),this.showFrm(),this.options.shadow&&this.showShadow()),this.showing=!0,this.options.onShow&&this.options.onShow()}},hide:function(){this.showing&&this.element&&(0>Browser.ua.indexOf("ie")&&"undefined"!=typeof Effect&&Effect?(Effect.Fade(this.element,{duration:.3,queue:{scope:"optMenu",position:"end"}}),this.options.shadow&&this.hideShadow_2()):(Element.hide(this.element),this.options.shadow&&this.hideShadow()),this.hideFrm(),this.showing=!1,this.options.onHide&&this.options.onHide())},buildFrm:function(){var t=document.createElement("iframe");this.elm_frm=t,t.style.position="absolute",t.frameborder="0",t.style.border="none",Element.hide(t),this.element.appendChild(t)},showFrm:function(){"ie5"!=Browser.ua&&"other"!=Browser.ua&&"ff"!=Browser.ua&&(this.elm_frm||this.buildFrm(),(parseInt(this.elm_frm.offsetHeight)!=parseInt(this.elm_win.offsetHeight)||parseInt(this.elm_frm.offsetWidth)!=parseInt(this.elm_win.offsetWidth))&&(this.elm_frm.style.zIndex=this.options.zIndex-10,this.elm_frm.style.width=this.elm_win.offsetWidth+"px",this.elm_frm.style.height=this.elm_win.offsetHeight+"px",Element.show(this.elm_frm)),clearTimeout(this.frmTimeout),this.frmTimeout=null,this.frmTimeout=setTimeout(this.showFrm.bind(this),100))},hideFrm:function(){this.elm_frm&&(clearTimeout(this.frmTimeout),this.frmTimeout=null,this.elm_frm.style.height="0px",Element.hide(this.elm_frm))},buildShadow:function(){var t=document.createElement("div");this.elm_shadow=t,t.style.position="absolute",t.style.background="#333",Element.setOpacity&&Element.setOpacity(t,.5),Element.hide(t),this.element.appendChild(t)},showShadow:function(){this.elm_shadow||this.buildShadow(),(this.elm_shadow.offsetHeight!=this.elm_win.offsetHeight||this.elm_shadow.offsetWidth!=this.elm_win.offsetWidth)&&(this.elm_shadow.style.left=parseInt(this.elm_win.style.left)+this.options.shadowOffset+"px",this.elm_shadow.style.top=parseInt(this.elm_win.style.top)+this.options.shadowOffset+"px",this.elm_shadow.style.zIndex=this.options.zIndex-1,this.elm_shadow.style.width=this.elm_win.offsetWidth+"px",this.elm_shadow.style.height=this.elm_win.offsetHeight+"px",Element.show(this.elm_shadow)),clearTimeout(this.shadowTimeout),this.shadowTimeout=null,this.shadowTimeout=setTimeout(this.showShadow.bind(this),100)},hideShadow:function(){this.elm_shadow&&(clearTimeout(this.shadowTimeout),this.shadowTimeout=null,this.elm_shadow.style.height="0px",Element.hide(this.elm_shadow))},buildShadow_2:function(){var t=document.createElement("div"),e=document.createElement("div");this.elm_shadow_r=t,this.elm_shadow_b=e,t.style.position="absolute",e.style.position="absolute",t.style.background="#333",e.style.background="#333",Element.setOpacity&&(Element.setOpacity(t,.5),Element.setOpacity(e,.5)),Element.hide(t),Element.hide(e),this.element.appendChild(t),this.element.appendChild(e)},showShadow_2:function(){this.elm_shadow_r&&this.elm_shadow_b||this.buildShadow_2(),(parseInt(this.elm_shadow_r.offsetHeight)!=parseInt(this.elm_win.offsetHeight)||parseInt(this.elm_shadow_b.offsetWidth)!=parseInt(this.elm_win.offsetWidth)-this.options.shadowOffset)&&(this.elm_shadow_r.style.left=parseInt(this.elm_win.style.left)+parseInt(this.elm_win.offsetWidth)+"px",this.elm_shadow_r.style.top=parseInt(this.elm_win.style.top)+this.options.shadowOffset+"px",this.elm_shadow_b.style.left=parseInt(this.elm_win.style.left)+this.options.shadowOffset+"px",this.elm_shadow_b.style.top=parseInt(this.elm_win.style.top)+parseInt(this.elm_win.offsetHeight)+"px",this.elm_shadow_r.style.zIndex=this.options.zIndex-1,this.elm_shadow_b.style.zIndex=this.options.zIndex-1,this.elm_shadow_r.style.width=this.options.shadowOffset+"px",this.elm_shadow_r.style.height=this.elm_win.offsetHeight+"px",this.elm_shadow_b.style.width=this.elm_win.offsetWidth-this.options.shadowOffset+"px",this.elm_shadow_b.style.height=this.options.shadowOffset+"px",Element.show(this.elm_shadow_r),Element.show(this.elm_shadow_b)),clearTimeout(this.shadowTimeout),this.shadowTimeout=null,this.shadowTimeout=setTimeout(this.showShadow_2.bind(this),100)},hideShadow_2:function(){this.elm_shadow_r&&this.elm_shadow_b&&(clearTimeout(this.shadowTimeout),this.shadowTimeout=null,this.elm_shadow_r.style.height="0px",this.elm_shadow_b.style.width="0px",Effect.Fade(this.elm_shadow_r,{duration:.3,queue:{scope:"optMenuShadow_r",position:"end"}}),Effect.Fade(this.elm_shadow_b,{duration:.3,queue:{scope:"optMenuShadow_b",position:"end"}}))}}}if(LinkFile===void 0||!LinkFile){var LinkFile=Class.create();LinkFile.prototype={initialize:function(t,e){this.options=Object.extend({type:"script",charset:"",noCache:!1,callBack:null},e||{}),this.options.callBack=Object.extend({variable:null,onLoad:null,timeout:2e4,timerStep:500},e.callBack||{}),this.timer=0,this.loadTimer=null,"script"==this.options.type?this.getJs(t.trim()):this.getCss(t.trim()),this.options.callBack.variable&&(this.options.callBack.vars=this.options.callBack.variable.split("."))},stop:function(){clearInterval(this.loadTimer),this.loadTimer=null,this.timer=0},doCallback:function(){return"script"==this.options.type&&this.options.callBack&&this.options.callBack.vars&&this.options.callBack.onLoad?(this.timer+=this.options.callBack.timerStep,$A(this.options.callBack.vars).any(function(v,i){var _v=this.options.callBack.vars.slice(0,i+1).join(".");return eval("typeof "+_v+'== "undefined"')||eval(_v+"==null")}.bind(this))&&this.timer<this.options.callBack.timeout||(clearInterval(this.loadTimer),$A(this.options.callBack.vars).all(function(v,i){var _v=this.options.callBack.vars.slice(0,i+1).join(".");return eval("typeof "+_v+'!= "undefined"')&&eval(_v+"!=null")}.bind(this))?this.options.callBack.onLoad():this.timer>=this.options.callBack.timeout&&this.options.callBack.onFailure&&this.options.callBack.onFailure(),this.loadTimer=null,this.timer=0),void 0):(this.stop(),void 0)},getJs:function(t){var e=document.getElementsByTagName("head")[0],i=Element.getChildElementByTagName(e,"SCRIPT");$A(i).each(function(e){getFullUrl(e.getAttribute("src")||"")==getFullUrl(t)&&Element.remove(e)}),this._link=document.createElement("script"),this.options.noCache&&(t+=(t.match(/\?/)?"&":"?")+"c="+timeStamp()),this._link.src=t,this._link.type="text/javascript",this.options.charset&&(this._link.charset=this.options.charset),this.options.callBack&&(this.loadTimer=setInterval(function(){this.doCallback()}.bind(this),this.options.callBack.timerStep)),e.appendChild(this._link)},getCss:function(t){var e=document.getElementsByTagName("head")[0],i=Element.getChildElementByTagName(e,"LINK");$A(i).each(function(e){getFullUrl(e.getAttribute("href")||"")==getFullUrl(t)&&Element.remove(e)}),this._link=document.createElement("link"),this.options.noCache&&(t+=(t.match(/\?/)?"&":"?")+"c="+timeStamp()),this._link.href=t,this._link.type="text/css",this._link.rel="stylesheet",this.options.charset&&(this._link.charset=this.options.charset),e.appendChild(this._link)}}}var ToolBar={init:function(){if($("toolBar")&&!this.hadInit){if(this.hadInit=!0,this.lastPassport=!1,this.pdt=$("toolBar").getAttribute("pdt"),!this.pdt)return alert("not defined production"),void 0;this.sohu3=!1,$("toolBar").getAttribute("sohu3")&&"true"==$("toolBar").getAttribute("sohu3")&&(this.sohu3=!0),this.build(),this.bindObserve()}},configs:{requestDistance:3,requestVn:"_j_requestSummary",requestCookie:"b_r",newsCountCookie:"b_n",newsCountVn:"_j_newsCountSummary",requestHideFilter:["^http://blog.sohu.com/home","^http://blog.sohu.com/manage/main.do"]},build:function(){this.buildUserInfo(),this.buildNav(),this.buildTools(),this.buildSysInfo()},buildUserInfo:function(){var t="";if(this.isLogin()){if(_gw!==void 0&&_gw){var e=_gw();t+='<span id="tb_welcome" title="现在心情如何？或许可以写些东东记录一下～" onmousedown="CA.q(\'toolbar_welcome\');">'+e+"</span>"}t+='<span id="tb_userN" class="tb_userN" title="欢迎您  '+this.getN()+'">',t+='<span class="tb_innerUserN" onmousedown="CA.q(\'toolbar_myPassport\');">',this.getIco()&&(t+='<img src="'+this.getIco()+'" alt="'+this.getN()+'" align="absmiddle" />'),t+=this.getShortName(this.getN()),t+='<span class="subMenuArrow2">&nbsp;</span>',t+="</span>",t+="</span>"}else if(this.isPPLogin())t+='<span class="txt">',t+='<span title="欢迎您 搜狐网友">欢迎您 <strong>'+this.getP()+"</strong></span>",t+='<span class="tb_spacer">|</span>',t+=this.isFreezed()?"您的帐号已被冻结":'<a href="'+this.getActivePath()+'" title="您还没有激活，请先激活" onmousedown="CA.q(\'toolbar_active\');">立即激活</a>',t+="</span>";else{var i=getCookie("lastdomain");if("string"==typeof i&&i.length>0&&(i=i.split("|"))&&i.length>=2&&(i=b64_decodex(i[1]))&&(i=i.replace(/^\||\|$/,"").split("|"))&&i.length>0&&(i=i[0])){utf8to16&&(i=utf8to16(i)),this.lastPassport=i;var s=i.substr(0,i.indexOf("@"));t+='<span class="txt" title="欢迎，'+s+'">欢迎，',t+=s,t+="</span>",t+='<span class="txt">',t+='<a id="tb_login" href="javascript:void(0)" title="登录" onmousedown="CA.q(\'toolbar_logon_notLogin\');">[请登录]</a>',t+='<a href="'+this.getRegPath()+'" title="注册" onmousedown="CA.q(\'toolbar_reg_notLogin\');">[注册]</a>',t+="</span>"}else t+='<span class="txt">',t+='<a id="tb_login" href="javascript:void(0)" title="登录" onmousedown="CA.q(\'toolbar_logon\');">登录</a>',t+='<span class="tb_spacer">|</span>',t+='<a href="'+this.getRegPath()+'" title="注册" onmousedown="CA.q(\'toolbar_reg\');">注册</a>',t+="</span>"}$("tb_user").innerHTML=t},buildNav:function(){var t="",e=!this.isPPLogin()&&this.lastPassport?"_notLogin":"";if(this.isLogin()||!this.isPPLogin()&&this.lastPassport){switch(t+='<a id="tb_goHome" class="tb_icon" href="'+this.getHomePath()+'" title="进入我的空间" onmousedown="CA.q(\'toolbar_myHome'+e+'\');">&nbsp;&nbsp;&nbsp;我的空间&nbsp;<span id="tb_newsCount"></span></a>',this.pdt){case"blog":t+='<a id="tb_goBlog" class="tb_icon" href="'+this.getBlogPath()+'" title="查看我的博客" onmousedown="CA.q(\'toolbar_myBlog'+e+"');\">&nbsp;&nbsp;&nbsp;我的博客</a>";break;case"video":t+='<a id="tb_goVideo" class="tb_icon" href="'+this.getVideoPath()+'" title="查看我的视频" target="_blank" onmousedown="CA.q(\'toolbar_myVideo'+e+"');\">&nbsp;&nbsp;&nbsp;我的视频</a>";break;case"pp":t+='<a id="tb_goPP" class="tb_icon" href="'+this.getAlbumPath()+'" title="查看我的相册" alt="查看我的相册" target="_blank" onmousedown="CA.q(\'toolbar_myPhoto'+e+"');\">&nbsp;&nbsp;&nbsp;我的相册</a>";break;case"group":t+='<a id="tb_goGroup" class="tb_icon" href="'+this.getMyGroupPath()+'" title="查看我的圈子" onmousedown="CA.q(\'toolbar_myGroups'+e+"');\">&nbsp;&nbsp;&nbsp;我的圈子</a>"}"blog"==this.pdt&&(t+='<a href="'+this.getBlogWritePath()+'" target="_blank" id="tb_new_entry" class="tb_icon" title="写博文" onmousedown="CA.q(\'toolbar_newEntry\');">&nbsp;&nbsp;&nbsp;发表&nbsp;<span class="subMenuArrow2 subMenuArrowGreen" id="tb_qTool" title="快捷工具">&nbsp;</span></a>'),"group"!=this.pdt&&"blog"!=this.pdt&&(t+='<a href="javascript:void(0)" id="tb_qTool" class="tb_icon_menu" title="快捷工具" onmousedown="CA.q(\'toolbar_quickTool'+e+'\');">&nbsp;&nbsp;&nbsp;上传&nbsp;<span class="subMenuArrow2">&nbsp;</span></a>'),$("tb_nav").innerHTML=t,Element.show($("tb_nav"))}},buildTools:function(){var t="";this.isLogin()&&(t+='<a id="tb_goRequest" class="tb_icon" href="javascript:ToolBar.needLogin(\'tb_goRequest\',\''+this.getRequestPath()+'\');" title="查看我的消息" onmousedown="CA.q(\'toolbar_myRequest'+e+'\');">&nbsp;&nbsp;<img id="tb_newReq" style="display:none;" align="absmiddle" src="http://js1.pp.sohu.com.cn/ppp/blog/styles_ppp/images/ico_new.gif" border="0" /></a>'),this.isLogin()&&(t+=0>Browser.ua.indexOf("ie")?'<a href="'+this.getMsgPath()+'" target="_blank" id="tb_sohuMsg" class="tb_icon" title="小纸条" onmousedown="CA.q(\'toolbar_myMsgIcon\');">&nbsp;</a>':'<span id="tb_sohuMsgFlash" title="小纸条"><embed src="http://images.chinaren.com/product/webim/mood/mood_blog.swf?UserID='+this.getP()+'" wmode="transparent" quality="high" pluginspage="htt p://www.macromedia.com/go/getflashplayer" type="application/x-shockwave-flash" menu="-1" allowscriptaccess="always" onmousedown="CA.q(\'toolbar_myMsgFlash\');" /></span>');var e=!this.isPPLogin()&&this.lastPassport?"_notLogin":"";(this.isLogin()||!this.isPPLogin()&&this.lastPassport)&&($("tb_tool").innerHTML=t,Element.show($("tb_tool")))},buildSysInfo:function(){this.isPPLogin()&&Element.show($("logoutBtn"))},refreshNewsCount:function(t){if(!t){var e;if((e=getCookie(this.configs.newsCountCookie))&&e.length>0)return this.updateNewsCount(e),void 0}var i=this.configs.newsCountVn;window[i]=null;var s=this.getXP()?"xp="+this.getXP():this.lastPassport?"pp="+this.lastPassport:"";s&&(s="http://mnf.blog.sohu.com/toolCount?vn="+i+"&"+s,new LinkFile(s,{type:"script",noCache:!0,callBack:{variable:i,onLoad:this.gotNewsCount.bind(this)}}))},gotNewsCount:function(){var t;(t=window[this.configs.newsCountVn])&&t.count&&(this.updateNewsCount(t.count),setCookie(this.configs.newsCountCookie,t.count,this.configs.requestDistance,"/","sohu.com"))},updateNewsCount:function(t){$("tb_newsCount")&&t>0&&($("tb_newsCount").innerHTML="["+t+"]",$("tb_goHome").title="您有 "+t+" 条新好友动态")},refreshRequests:function(t){if(!t){var e;if((e=getCookie(this.configs.requestCookie))&&(e=e.split(","))&&e.length>0)return this.updateRequests(e),void 0}var i=this.configs.requestVn;window[i]=null;var s=this.getXP()?"xp="+this.getXP():this.lastPassport?"pp="+this.lastPassport:"";s&&(s="http://req.blog.sohu.com/summary?vn="+i+"&"+s,new LinkFile(s,{type:"script",noCache:!0,callBack:{variable:i,onLoad:this.gotRequests.bind(this)}}))},gotRequests:function(){var t;
if((t=window[this.configs.requestVn])&&0==t.status&&(t=t.data)){for(var e=["requestCount","noticeCount","messageCount","notice1Count","notice3Count","notice4Count","notice8Count","notice9Count","request5Count","request6Count","notice10Count"],i=[],s=0,o=e.length;o>s;s++)i.push(t[e[s]]);this.updateRequests(i),setCookie(this.configs.requestCookie,i.join(","),this.configs.requestDistance,"/","sohu.com")}},updateRequests:function(t){var e;if(t&&t.length&&(e=$("tb_newReq"))){for(var i=!0,s=this.configs.requestHideFilter,o=window.location.href,n=0,a=s.length;a>n;n++){var l=s[n],r=l.charAt(0),h=l.substring(1,l.length);"^"==r?0==o.indexOf(h)&&(i=!1):"="==r&&o==h&&(i=!1)}var p=["request","notice","message","notice1","notice3","notice4","notice8","notice9","request5","request6","notice10"],d=["条","条","条","条","条","条","条","个","条","条","个"],u=["请求","通知","系统消息","留言评论","圈子通知","好友通知","分享通知","招呼","好友请求","圈子请求","博客活动"],c=["home/soRequest/request.do","home/soRequest/inform.do","home/soRequest/system.do","home/soRequest/inform.do?type=1","home/soRequest/inform.do?type=3","home/soRequest/inform.do?type=4","home/soRequest/inform.do?type=8","home/soRequest/inform.do?type=9","home/soRequest/request.do?m=listfriend","home/soRequest/request.do?m=listgroup","home/soRequest/inform.do?type=10"],m=[3,7,6,4,2,8,5,10],g=[],b=-1;g.push('<table border="0" cellspacing="7" cellpadding="0">');for(var f=this.isLogin(),n=0,a=m.length,l=0;a>n&&!(n>=t.length);n++)if((l=t[m[n]])&&l>0){var _=m[n];b++;var v=f?'href="http://blog.sohu.com/'+c[_]+'" target="_blank" onmousedown="CA.q(\'toolbar_request_'+p[_]+"_login')\"":'href="javascript:void(0);" onmousedown="CA.q(\'toolbar_request_'+p[_]+"_notLogin')\" onclick=\"ToolBar.goHomeTip.close();setTimeout(function() {ToolBar.needLogin('tb_goHome');}, 0);return false;\"",w='<td><a class="red" '+v+"><strong>"+l+"</strong>"+d[_]+"</a> 新"+u[_]+"</td>";if(0==b%2?g.push("<tr>"+w):g.push(w+"</tr>"),b>2)break}0==b%2&&g.push("<td> </td></tr>"),g.push("</table>");var C=[];if(b>=0&&C.push("您有"),b>=0){var B=e.parentNode;if(B["data-tip-ico"]="http://js1.pp.sohu.com.cn/ppp/images/icons/ico_mymessage.gif",B["data-tip-icoAlt"]="新消息",B["data-tip-title"]=C.join(""),B["data-tip-content"]=g.join(""),B["data-tip-closeDelay"]=5e3,Element.show(e),this.goHomeTip&&i&&(this.isLogin()?Event.observe(window,"load",this.goRequestTip.showMoment.bind(this.goRequestTip,11e3)):Event.observe(window,"load",this.goRequestTip.show.bind(this.goRequestTip))),$("newReqCount")){for(var y=0,n=0,a=Math.min(t.length,3);a>n;n++)y+=t[n];y>0&&($("newReqCount").innerHTML="("+y+")")}}}},bindObserve:function(){this.bindUserInfo(),this.bindNav(),this.bindTools(),this.refreshNewsCount(),this.refreshRequests()},bindUserInfo:function(){this.isLogin()||(this.loginBtn=$("tb_login"),this.goHomeBtn=$("tb_goHome"),this.loginBtn&&(Event.observe(this.loginBtn,"click",Event.stop.bindAsEventListener(this)),Event.observe(this.loginBtn,"click",this.needLogin.bind(this))),this.goHomeBtn&&(Event.observe(this.goHomeBtn,"click",Event.stop.bindAsEventListener(this)),Event.observe(this.goHomeBtn,"click",this.needLogin.bind(this,null,"http://blog.sohu.com/home")))),$("tb_userN")&&(this.btnUserN=$("tb_userN"),this.loginBtn=$("tb_userN"),Event.observe(this.btnUserN,"mouseover",function(){Element.addClassName(this.btnUserN,"tb_userN-over")}.bindAsEventListener(this)),Event.observe(this.btnUserN,"mouseout",function(){Element.removeClassName(this.btnUserN,"tb_userN-over")}.bindAsEventListener(this)),Event.observe(this.btnUserN,"click",Event.stop.bindAsEventListener(this)),Event.observe(this.btnUserN,"click",function(){this.isLogin()?(this.showLogin(),this.btnUserNTip.hide()):confirm("您还没有登录，是否现在登录？")&&(location.href=this.getLoginPath())}.bindAsEventListener(this)),this.btnUserN&&(this.btnUserNTip=new ToolBar.Tip(this.btnUserN)))},bindNav:function(){$("tb_goHome")&&(this.goHomeBtn=$("tb_goHome"),this.goHomeBtn&&(this.goHomeTip=new ToolBar.Tip(this.goHomeBtn))),$("tb_goRequest")&&(this.goRequestBtn=$("tb_goRequest"),this.goRequestBtn&&(this.goRequestTip=new ToolBar.Tip(this.goRequestBtn))),$("tb_goGroup")&&(this.goGroupBtn=$("tb_goGroup"),this.goGroupBtn&&(this.goGroupTip=new ToolBar.Tip(this.goGroupBtn))),$("tb_goBlog")&&(this.goBlogBtn=$("tb_goBlog"),this.goBlogBtn&&(this.goBlogTip=new ToolBar.Tip(this.goBlogBtn))),$("tb_goPP")&&(this.goPPBtn=$("tb_goPP"),this.goPPBtn&&(this.goPPTip=new ToolBar.Tip(this.goPPBtn))),$("tb_goVideo")&&(this.goVideoBtn=$("tb_goVideo"),this.goVideoBtn&&(this.goVideoTip=new ToolBar.Tip(this.goVideoBtn)))},bindTools:function(){$("tb_sohuMsg")&&(this.sohuMsgBtn=$("tb_sohuMsg"),this.sohuMsgBtn&&(this.sohuMsgTip=new ToolBar.Tip(this.sohuMsgBtn))),$("tb_qTool")&&(this.btnQTool=$("tb_qTool"),Event.observe(this.btnQTool,"click",Event.stop.bindAsEventListener(this)),Event.observe(this.btnQTool,"click",function(){this.showQToolMenu(),this.btnQTool.blur(),this.qToolTip.hide()}.bindAsEventListener(this)),this.btnQTool&&(this.qToolTip=new ToolBar.Tip(this.btnQTool)))},showQToolMenu:function(){if(this.btnQTool){if(!this.qToolMenu){var t={menuData:[{title:null,active:!0,data:[]}],title:null,clsBtn:!1,autoCls:!0,autoActive:!1,btn:this.btnQTool,displace:[0,0],placeIn:$("toolBar"),zIndex:1500,sDivCss:"menuSub-div menuSub-div-qTool"},e=[];"blog"==this.pdt&&(e=[{text:'<span id="tb_write" onmousedown="CA.q(\'toolbar_quickTool_entry\')">写博文</span>',title:"写博文",action:this.gotoBlogWrite.bind(this),value:null},{text:'<span id="tb_uploadPhoto" onmousedown="CA.q(\'toolbar_quickTool_photo\')"> 上传新照片</span>',title:"上传新照片",action:this.getPPUploadPath.bind(this),value:null},{text:'<span id="tb_uploadVideo" onmousedown="CA.q(\'toolbar_quickTool_video\')"> 上传新视频</span>',title:"上传新视频",action:this.getVideoUploadPath.bind(this),value:null},{text:"<span id=\"tb_addLink\" onmousedown=\"CA.q('toolbar_quickTool_addFriend');CA.q('friend_from_toolbar')\"> 添加为好友</span>",title:"添加为好友",action:addToFav,value:null}]),"pp"==this.pdt&&(e=[{text:'<span id="tb_uploadPhoto"> 上传照片</span>',title:"上传照片",action:this.getPPUploadPath.bind(this),value:null},{text:'<span id="tb_addAlbum"> 新建专辑</span>',title:"新建专辑",action:Album.add.bind(Album),value:this},{text:'<span id="tb_createSlide"> 创建动感相册</span>',title:"创建动感相册",action:this.getSlidePath.bind(this),value:null},{text:'<span id="tb_addLink"> 加为好友</span>',title:"加为好友",action:Friend.add.bind(Friend),value:null}]),"video"==this.pdt&&(e=[{text:'<span id="tb_uploadVideo"> 上传</span>',title:"上传新视频",action:this.getVideoUploadPath.bind(this),value:null},{text:'<span id="tb_recordVideo"> 录制</span>',title:"录制新视频",action:this.getVideoRecordPath.bind(this),value:null}]),t.menuData[0].data=t.menuData[0].data.concat(e),this.qToolMenu=new WinMenu(t)}this.qToolMenu.win.showing?this.qToolMenu.hide():(this.qToolMenu.show(),this.loginMenu&&this.loginMenu.hide())}},showLogin:function(t){if(this.loginBtn){if(!this.loginMenu){var e=Position.cumulativeOffset(this.loginBtn);e=[e[0],e[1]+parseInt(this.loginBtn.offsetHeight)+2];var i={content:this.getLoginInnerDiv(),title:null,clsBtn:!1,autoCls:!0,autoActive:!1,position:e,placeIn:$("toolBar"),zIndex:1500,sDivCss:"menuSub-div menuSub-div-login"};this.loginMenu=new Win(i),setTimeout(function(){PassportSC.cardTitle="上搜狐，知天下","string"==typeof t&&t.length>0&&(PassportSC.loginRedirectUrl=t),PassportSC.isShowRemPwdMsg=0,PassportSC.drawPassport(this.loginInnerDiv),setTimeout(function(){this.lastPassport&&(PassportSC.emailInput.value=this.lastPassport,setTimeout(function(){PassportSC.passwdInput.focus()},1))}.bind(this),0)}.bind(this),10)}this.loginMenu.showing?this.loginMenu.hide():(this.loginMenu.show(),""===PassportSC.emailInput.value?setTimeout(function(){PassportSC.emailInput.focus()},1):PassportSC.passwdInput&&setTimeout(function(){PassportSC.passwdInput.focus()},1),this.qToolMenu&&this.qToolMenu.hide())}},getLoginInnerDiv:function(){var t=document.createElement("div");return this.loginInnerDiv=t,t.innerHTML="loading...",t},showStartMenu:function(){if(this.btnUserN){if(!this.startMenu){var t=Position.cumulativeOffset(this.btnUserN);t=[t[0],t[1]+parseInt(this.btnUserN.offsetHeight)+2];var e={content:this.getStartInnerDiv(),title:null,clsBtn:!1,autoCls:!0,autoActive:!1,position:t,placeIn:$("toolBar"),zIndex:1500,sDivCss:"menuSub-div menuSub-div-start",onShow:function(){Element.addClassName(this.btnUserN,"tb_userN-down")}.bind(this),onHide:function(){Element.removeClassName(this.btnUserN,"tb_userN-down")}.bind(this)};this.startMenu=new Win(e),setTimeout(function(){this.bindStartMenu(),this.sm_activeMenu(this.pdt),this.updateBaseInfo()}.bind(this),10)}this.startMenu.showing?this.startMenu.hide():this.startMenu.show()}},getStartInnerDiv:function(){var t=document.createElement("div");this.startInnerDiv=t,t.className="pst";var e="";e+='<div class="pst_head clearfix">',e+='<div class="pst_title">搜狐<span class="pst_p">通行证</span></div>',this.sohu3&&(e+='<div class="pst_sohu3">搜狐3.0</div>'),e+='<div class="pst_close"></div>',e+="</div>",e+='<div class="pst_body clearfix">',e+='<div class="pst_content">',e+='<div class="pst_tips">...</div>',e+='<div class="pst_innerContent">',e+='<div class="pst_content_load pst_loader">正在读取...</div>',e+="</div>",e+="</div>",e+='<div class="pst_sidebar">',e+='<div class="pst_ico">',e+='<img src="'+this.getIco()+'" alt="'+this.getN()+'" onmousedown="CA.q(\'toolbar_myPassport_icon\');" />',e+="</div>",e+='<ul class="pst_pdtMenu">',e+='<li pdt="blog"><a href="'+this.getBlogPath()+'" class="pst_pdtMenuName" target="_blank" onmousedown="CA.q(\'toolbar_myPassport_nav_blog\');"><span class="pst_mnBlog">&nbsp;</span>博客</a><a href="javascript:void(0)" class="pst_pdtMenuArrow" onmousedown="CA.q(\'toolbar_myPassport_nav_blogArrow\');"> </a></li>',e+='<li pdt="pp"><a href="'+this.getPPPath()+'" class="pst_pdtMenuName" target="_blank" onmousedown="CA.q(\'toolbar_myPassport_nav_pp\');"><span class="pst_mnPP">&nbsp;</span>相册</a><a href="javascript:void(0)" class="pst_pdtMenuArrow" onmousedown="CA.q(\'toolbar_myPassport_nav_ppArrow\');"> </a></li>',e+='<li pdt="music"><a href="'+this.getMusicPath()+'" class="pst_pdtMenuNameWide" target="_blank" onmousedown="CA.q(\'toolbar_myPassport_nav_music\');"><span class="pst_mnMusic">&nbsp;</span>音乐</a></li>',e+='<li pdt="video"><a href="'+this.getVideoPath()+'" class="pst_pdtMenuName" target="_blank" onmousedown="CA.q(\'toolbar_myPassport_nav_video\');"><span class="pst_mnVideo">&nbsp;</span>视频</a><a href="javascript:void(0)" class="pst_pdtMenuArrow" onmousedown="CA.q(\'toolbar_myPassport_nav_videoArrow\');"> </a></li>',e+='<li pdt="group"><a href="'+this.getGroupPath()+'" class="pst_pdtMenuName" target="_blank" onmousedown="CA.q(\'toolbar_myPassport_nav_group\');"><span class="pst_mnGroup">&nbsp;</span>圈子</a><a href="javascript:void(0)" class="pst_pdtMenuArrow" onmousedown="CA.q(\'toolbar_myPassport_nav_groupArrow\');"> </a></li>',e+="</ul>",e+="</div>",e+="</div>",e+='<div class="pst_foot clearfix">',e+='<div class="pst_otherPdt" onmousedown="CA.q(\'toolbar_myPassport_goOtherPdt\');">';var i=[];return $H(PassportSC.cookie.service).each(function(t){if(!t.value||"blog"==t.key||"pp"==t.key||"music"==t.key)throw $continue;_url=PassportSC.appUrl[t.key],"mail"==t.key&&(_url="sohu"==t.value?"http://mail.sohu.com":"sogou"==t.value?"http://mail.sogou.com/2gmail/login.jsp":"http://mail.chinaren.com");var e="";e+='<a href="'+_url+'" target="_blank">'+PassportSC.appName[t.key]+"</a>",i.push(e)}),e+=i.join("<span>&nbsp;|&nbsp;</span>"),e+="</div>",e+='<div class="pst_camp">',e+='<a href="http://blog.sohu.com/camp?from=tb_'+this.pdt+'" target="_blank"></a>',e+="</div>",e+="</div>",t.innerHTML=e,t},updateBaseInfo:function(){var t=this.getBaseInfoPath();new LinkFile(t,{type:"script",noCache:!1,callBack:{variable:"Blog.camp",onLoad:this.sm_showBaseInfo.bind(this)}})},sm_showBaseInfo:function(){if(Blog.camp.profile&&Blog.camp.sysRec){this.ico.base=Blog.camp.profile.ico,this.name.base=this.getP(),this.sm_updateIco();var t="";t+='<a href="'+Blog.camp.sysRec.tip.url+'" target="_blank" onmousedown="CA.q(\'toolbar_myPassport_tips\');">'+Blog.camp.sysRec.tip.title+"</a>",this.tipsBox=document.getElementsByClassName("pst_tips",this.startInnerDiv,"div")[0],this.tipsBox&&(this.tipsBox.innerHTML=t)}},ico:{},name:{},sm_updateIco:function(){if(this.icoBox=document.getElementsByClassName("pst_ico",this.startInnerDiv,"div")[0],this.icoBox){var t="",e="";"blog"==this.sm_actived&&this.ico.blog&&this.name.blog?(t=this.ico.blog,e=this.name.blog):"pp"==this.sm_actived&&this.ico.pp?(t=this.ico.pp,e=this.name.pp):"video"==this.sm_actived&&this.ico.video?(t=this.ico.video,e=this.name.video):"group"==this.sm_actived&&this.ico.group&&(t=this.ico.group,e=this.name.group),t=t||this.ico.base,e=e||this.name.base,t&&e&&(this.icoBox.innerHTML='<img src="'+t+'" alt="'+e+'" />')}},bindStartMenu:function(){var t=document.getElementsByClassName("pst_pdtMenu",this.startInnerDiv,"ul")[0];this.pdtMenus=t.childNodes,$A(this.pdtMenus).each(function(t){var e=t.getAttribute("pdt");document.getElementsByClassName("pst_pdtMenuName",t,"a")[0];var i=document.getElementsByClassName("pst_pdtMenuArrow",t,"a")[0];Event.observe(t,"mouseover",function(){Element.addClassName(t,"pst_pdtMenu-over")}.bindAsEventListener(this)),Event.observe(t,"mouseout",function(){Element.removeClassName(t,"pst_pdtMenu-over")}.bindAsEventListener(this)),i&&Event.observe(i,"click",function(){this.sm_activeMenu(e)}.bindAsEventListener(this))}.bind(this))},sm_overMenu:function(t){$A(this.pdtMenus).each(function(e){var i=e.getAttribute("pdt");Element.removeClassName(e,"pst_pdtMenu-over"),i==t&&Element.addClassName(e,"pst_pdtMenu-over");var s=document.getElementsByClassName("pst_pdtMenuArrow",e,"a")[0];i!=t&&s&&Element.removeClassName(s,"pst_pdtMenuArrow-active")}.bind(this))},sm_activeMenu:function(t){this.sm_actived=t||this.sm_actived,this.sm_updateIco(),$A(this.pdtMenus).each(function(t){var e=t.getAttribute("pdt"),i=document.getElementsByClassName("pst_pdtMenuArrow",t,"a")[0];Element.removeClassName(t,"pst_pdtMenuActive"),i&&Element.removeClassName(i,"pst_pdtMenuArrow-active"),e==this.sm_actived&&(Element.addClassName(t,"pst_pdtMenuActive"),i&&Element.addClassName(i,"pst_pdtMenuArrow-active"))}.bind(this)),setTimeout(this.sm_showContent.bind(this,this.sm_actived),10)},sm_showContent:function(t){t=this.sm_actived,this.sm_contentBox||(this.sm_contentBox=document.getElementsByClassName("pst_innerContent",this.startInnerDiv,"div")[0]),this.sm_contentLoader||(this.sm_contentLoader=document.getElementsByClassName("pst_content_load",this.sm_contentBox,"div")[0]),Element.show(this.sm_contentLoader),this.sm_content_blog&&Element.hide(this.sm_content_blog),this.sm_content_pp&&Element.hide(this.sm_content_pp),this.sm_content_video&&Element.hide(this.sm_content_video),this.sm_content_group&&Element.hide(this.sm_content_group),"blog"==t?this.sm_showContent_blog():"pp"==t?this.sm_showContent_pp():"video"==t?this.sm_showContent_video():"group"==t&&this.sm_showContent_group()},sm_showContent_blog:function(){if(!this.sm_content_blog){this.sm_content_blog=document.createElement("div");var t="";t+='<div class="pst_cnt_actions">',t+="blog"==this.pdt&&this.isMyPdt()&&0>location.pathname.indexOf("/manage/")&&0>location.pathname.indexOf("/home/")?'<a href="'+this.getHomePath()+'" target="_blank" onmousedown="CA.q(\'toolbar_myPassport_blog_myHome\');">进入我的空间</a>':'<a href="'+this.getBlogPath()+'" target="_blank" onmousedown="CA.q(\'toolbar_myPassport_blog_myBlog\');">查看我的博客</a>',t+='&nbsp;|&nbsp;<a href="'+this.getBlogWritePath()+'" target="_blank" onmousedown="CA.q(\'toolbar_myPassport_blog_write\');">撰写新日志</a>',t+="</div>",t+="<div>",t+='<div class="pst_mTitle"><div class="pst_mRfs" onmousedown="CA.q(\'toolbar_myPassport_blog_comment_refresh\');"></div>最新评论</div>',t+='<div class="pst_mCnt" onmousedown="CA.q(\'toolbar_myPassport_blog_comment\');"></div>',t+="</div>",this.sm_content_blog.innerHTML=t,this.sm_content_blog_comment=document.getElementsByClassName("pst_mCnt",this.sm_content_blog,"div")[0],this.sm_content_blog_rfs=document.getElementsByClassName("pst_mRfs",this.sm_content_blog,"div")[0],Event.observe(this.sm_content_blog_rfs,"click",this.sm_updateData_blog.bind(this,!0)),this.sm_contentBox.appendChild(this.sm_content_blog),this.sm_updateData_blog()}Element.hide(this.sm_contentLoader),Element.show(this.sm_content_blog)},sm_updateData_blog:function(){if("undefined"!=typeof Blog&&Blog.camp&&Blog.camp.status&&Blog.camp.status.comments)this.sm_showContent_blog_comment();else{"undefined"!=typeof Blog&&Blog.camp&&(Blog.camp=null),this.sm_content_blog_comment.innerHTML=this.getLoader();var t=this.getBlogDataPath();new LinkFile(t,{type:"script",noCache:!1,callBack:{variable:"Blog.camp",onLoad:this.sm_showContent_blog_comment.bind(this),onFailure:this.sm_updateDataFailue.bind(this,this.sm_content_blog_comment)}})}},sm_showContent_blog_comment:function(){if(Blog.camp.profile&&(this.ico.blog=Blog.camp.profile.ico,this.name.blog=this.getP(),this.sm_updateIco(),Blog.camp.status&&Blog.camp.status.comments)){var t="";0>=Blog.camp.status.comments.length?t+="暂无评论":(t+="<ul>",$A(Blog.camp.status.comments).each(function(e){t+='<li><a href="'+e.url+'" target="_blank" title="'+e.cont+'">'+e.cont+"</a></li>"}),t+="</ul>"),this.sm_content_blog_comment.innerHTML=t}},sm_showContent_pp:function(){if(!this.sm_content_pp){this.sm_content_pp=document.createElement("div");var t="";t+='<div class="pst_cnt_actions">',t+='<a title="上传照片" href="javascript:ToolBar.getPPUploadPath();" class="pst_cnt_pp_btn_up" onmousedown="CA.q(\'toolbar_myPassport_pp_uploadPhoto\');">上传照片</a>',"pp"==this.pdt&&(t+='&nbsp;|&nbsp;<a title="新建专辑" onclick="Album.add(this);" onmousedown="CA.q(\'toolbar_myPassport_pp_newSet\');">新建专辑</a>'),t+='&nbsp;|&nbsp;<a title＝"创建动感相册" href="javascript:ToolBar.getSlidePath();" class="pst_cnt_pp_btn_up" onmousedown="CA.q(\'toolbar_myPassport_pp_newSlid\');">创建动感相册</a>',t+="</div>",t+="<div>",t+='<div class="pst_mTitle"><div class="pst_mRfs" onmousedown="CA.q(\'toolbar_myPassport_pp_comment_refresh\');"></div>最新评论</div>',t+='<div class="pst_mCnt" onmousedown="CA.q(\'toolbar_myPassport_pp_comment\');"></div>',t+="</div>",this.sm_content_pp.innerHTML=t,this.sm_content_pp_btn_up=document.getElementsByClassName("pst_cnt_pp_btn_up",this.sm_content_pp,"a")[0],this.sm_content_pp_comment=document.getElementsByClassName("pst_mCnt",this.sm_content_pp,"div")[0],this.sm_content_pp_rfs=document.getElementsByClassName("pst_mRfs",this.sm_content_pp,"div")[0],Event.observe(this.sm_content_pp_rfs,"click",this.sm_updateData_pp.bind(this,!0)),this.sm_contentBox.appendChild(this.sm_content_pp),this.sm_updateData_pp()}Element.hide(this.sm_contentLoader),Element.show(this.sm_content_pp)},sm_updateData_pp:function(){this.sm_content_pp_comment.innerHTML=this.getLoader();var t=this.getPPDataPath();new LinkFile(t,{type:"script",noCache:!1,callBack:{variable:"PP.camp",onLoad:this.sm_showContent_pp_comment.bind(this),onFailure:this.sm_updateDataFailue.bind(this,this.sm_content_pp_comment)}})},sm_showContent_pp_comment:function(){if(!PP.camp.profile)return this.sm_content_pp_comment.innerHTML="暂无评论",void 0;if(this.ico.pp=PP.camp.profile.userIco,this.name.pp=PP.camp.profile.ppName,this.sm_updateIco(),PP.camp.status.usercomments){var t="";0>=PP.camp.status.usercomments.length?t+="暂无评论":(t+="<ul>",$A(PP.camp.status.usercomments).each(function(e){t+='<li><a href="'+e.url+'" target="_blank" title="'+this.unescapeHTML(e.text.replace("<br />",""))+'">'+this.unescapeHTML(e.text.replace("<br />",""))+"</a></li>"}.bind(this)),t+="</ul>"),this.sm_content_pp_comment.innerHTML=t}},sm_showContent_video:function(){if(!this.sm_content_video){this.sm_content_video=document.createElement("div");var t="";t+='<div class="pst_cnt_actions">',t+='<a href="'+this.getVideoPath()+'" target="_blank">查看我的视频</a>',t+='&nbsp;|&nbsp;<a href="javascript:ToolBar.getVideoUploadPath()">上传视频</a>',t+='&nbsp;|&nbsp;<a href="javascript:ToolBar.getVideoRecordPath()">录制视频</a>',t+="</div>",t+="<div>",t+='<div class="pst_mTitle"><div class="pst_mRfs"></div>我的订阅</div>',t+='<div class="pst_mCnt"></div>',t+="</div>",this.sm_content_video.innerHTML=t,this.sm_content_video_sub=document.getElementsByClassName("pst_mCnt",this.sm_content_video,"div")[0],this.sm_content_video_rfs=document.getElementsByClassName("pst_mRfs",this.sm_content_video,"div")[0],Event.observe(this.sm_content_video_rfs,"click",this.sm_updateData_video.bind(this,!0)),this.sm_contentBox.appendChild(this.sm_content_video),this.sm_updateData_video()}Element.hide(this.sm_contentLoader),Element.show(this.sm_content_video)},sm_updateData_video:function(t){this.sm_content_video_sub.innerHTML=this.getLoader();var e=this.getVideoDataPath();new LinkFile(e,{type:"script",noCache:t,callBack:{variable:"VBlog.camp",onLoad:this.sm_showContent_video_sub.bind(this),onFailure:this.sm_updateDataFailue.bind(this,this.sm_content_video_sub)}})},sm_showContent_video_sub:function(){if(VBlog.camp.profile&&(this.ico.video=VBlog.camp.profile.ico,this.name.video=VBlog.camp.profile.nick,this.sm_updateIco(),VBlog.camp.status.userSub)){var t="";0>=VBlog.camp.status.userSub.length?t+="暂无订阅":(t+="<ul>",$A(VBlog.camp.status.userSub).each(function(e){t+='<li class="pst_videoSub">',t+='<h5><a href="'+e.authorUrl+'" target="_blank">'+e.authorName+"</a></h5>",e.cover&&e.title?(t+='<a href="'+e.url+'" target="_blank" class="pst_videoCover"><img src="'+e.cover+'" alt="'+e.title+'" /></a>',t+='<span class="pst_videoDesc">',t+='<a href="'+e.url+'" target="_blank">'+e.title+"</a><br />",t+=this.getIntervalTime(e.createTime),t+="</span>"):t+="<span>该用户还没有视频</span>",t+='<span style="clear:both;display:block;"></span>',t+="</li>"}.bind(this)),t+="</ul>"),this.sm_content_video_sub.innerHTML=t}},sm_showContent_group:function(){if(!this.sm_content_group){this.sm_content_group=document.createElement("div");var t="";t+='<div class="pst_cnt_actions">',t+='<a href="'+this.getGroupUserInfoPath()+'" target="_blank">个人信息</a>',t+='&nbsp;&nbsp;|&nbsp;&nbsp;积分:<span class="pst_groupScore">...</span>&nbsp;&nbsp;&nbsp;头衔:<span class="pst_groupRank">...</span>',t+="</div>",t+="<div>",t+='<div class="pst_mTitle"><div class="pst_mRfs"></div>参与的圈子</div>',t+='<div class="pst_mCnt"></div>',t+="</div>",this.sm_content_group.innerHTML=t,this.sm_content_group_scoreBox=document.getElementsByClassName("pst_groupScore",this.sm_content_group,"span")[0],this.sm_content_group_rankBox=document.getElementsByClassName("pst_groupRank",this.sm_content_group,"span")[0],this.sm_content_group_join=document.getElementsByClassName("pst_mCnt",this.sm_content_group,"div")[0],this.sm_content_group_rfs=document.getElementsByClassName("pst_mRfs",this.sm_content_group,"div")[0],Event.observe(this.sm_content_group_rfs,"click",this.sm_updateData_group.bind(this,!0)),this.sm_contentBox.appendChild(this.sm_content_group),this.sm_updateData_group()}Element.hide(this.sm_contentLoader),Element.show(this.sm_content_group)},sm_updateData_group:function(t){this.sm_content_group_join.innerHTML=this.getLoader();var e=this.getGroupDataPath();new LinkFile(e,{type:"script",noCache:t,callBack:{variable:"Q.camp",onLoad:this.sm_showContent_group_join.bind(this),onFailure:this.sm_updateDataFailue.bind(this,this.sm_content_group_join)}})},sm_showContent_group_join:function(){if(!Q.camp.profile)return this.sm_content_group_join.innerHTML="暂无圈子",void 0;if(this.ico.group=Q.camp.profile.ico,this.name.group=Q.camp.profile.nick,this.sm_updateIco(),this.sm_content_group_scoreBox.innerHTML=Q.camp.profile.score,this.sm_content_group_rankBox.innerHTML=Q.camp.profile.rank-0+1+"级 "+Q.camp.profile.rankName,Q.camp.links.groups){var t="";if(0>=Q.camp.links.groups.length)t+="暂无圈子";else{var e="",i="";$A(Q.camp.links.groups).each(function(t){1==t.role||2==t.role?e+='<li><a href="'+t.url+'" target="_blank"><img src="'+t.ico+'" alt="'+t.name+'" align="absmiddle" /></a> <a href="'+t.url+'" target="_blank">'+t.name+'</a> <input type="button" value="管理" onclick="window.open(\'http://q.sohu.com/manage/group.do?id='+t.id+'&action=edit.basic\');" align="absmiddle" /></li>':i+='<li><a href="'+t.url+'" target="_blank"><img src="'+t.ico+'" alt="'+t.name+'" align="absmiddle" /></a> <a href="'+t.url+'" target="_blank">'+t.name+"</a></li>"}),t+='<ul class="pst_groupJoin">',t+=e,t+=i,t+="</ul>"}this.sm_content_group_join.innerHTML=t}},sm_updateDataFailue:function(t){t.innerHTML="读取数据失败，请尝试重新刷新。"},doLogout:function(){logoutApp(),PassportSC.logoutHandle(document.getElementsByTagName("head")[0],ToolBar.logoutFailCall,ToolBar.logoutSuccessCall)},logoutFailCall:function(){PassportSC.reportMsg("8")},logoutSuccessCall:function(){location.pathname.indexOf("/manage/")>=0?location.href="http://blog.sohu.com":location.reload()},disableBtn:function(t){Element.addClassName(t,"disable")},ableBtn:function(t){Element.removeClassName(t,"disable")},getShortName:function(t){if(null==t)return null;for(var e=/^[\x00-\xff]+$/,i=0,s=8,o="",n=0;t.length>n;n++){var a=t.charAt(n);if(i+=e.test(a)?1:2,i>s){o=o.substr(0,o.length-1)+"..";break}o+=a}return o},isLogin:function(){return"group"==this.pdt?User.isLogin():"blog"==this.pdt?isLogin():"video"==this.pdt?Role.isMver:"pp"==this.pdt?Role.isPper:null},isPPLogin:function(){return"group"==this.pdt?User.isPPLogin():"blog"==this.pdt?isPPLogin():"video"==this.pdt?Role.isLogin:"pp"==this.pdt?Role.isLogin:null},isFreezed:function(){return"pp"==this.pdt?-1==Role.status:void 0},getN:function(){if("group"==this.pdt)return this.name.group=User.getN(),User.getN();if("blog"==this.pdt){var t=getP();return this.name.blog=t,t.indexOf("@focus.cn")>-1&&(t=PassportSC.cookieHandle()),t}return"video"==this.pdt?(this.name.video=Role.nick,Role.nick):"pp"==this.pdt?(this.name.pp=Role.nick,Role.nick):null},getIco:function(){return"group"==this.pdt?(this.ico.group=User.getIco(),User.getIco()):"blog"==this.pdt?(this.ico.blog=getUserIco(),getUserIco()):"video"==this.pdt?(this.ico.video=Role.ico,Role.ico):"pp"==this.pdt?(this.ico.pp=Role.ico,Role.ico):null},getP:function(){return"group"==this.pdt?User.getP():"blog"==this.pdt?getP():"video"==this.pdt||"pp"==this.pdt?Role.pp:null},getXP:function(){return"group"==this.pdt?User.getXP():"blog"==this.pdt?getXP():"video"==this.pdt||"pp"==this.pdt?Role.xpp:null},isMyPdt:function(){return"blog"==this.pdt?isMyBlog():"video"==this.pdt||"pp"==this.pdt?Role.isOwner:null},clearUser:function(){"group"==this.pdt?User.clearCookie():"blog"==this.pdt?BlogCookieInfo.clear():("video"==this.pdt||"pp"==this.pdt)&&Role.clear()},getRegPath:function(){return"video"==this.pdt?"http://blog.sohu.com/login/regnew.do?bru=http%3A%2F%2Fv.blog.sohu.com%2Fpassport":"group"==this.pdt?"http://blog.sohu.com/login/regnew.do?bru=http%3A%2F%2Fq.sohu.com%2Flogin%2Factivation.do":"pp"==this.pdt?"http://blog.sohu.com/login/regnew.do?from=pp":"http://blog.sohu.com/login/reg.do"},getActivePath:function(){return"group"==this.pdt?"http://q.sohu.com/login/activation.do":"blog"==this.pdt||"video"==this.pdt?"http://blog.sohu.com/login/activation.do":"pp"==this.pdt?"http://pp.sohu.com/signin.jhtml":null},getLoginPath:function(){return"group"==this.pdt||"blog"==this.pdt||"video"==this.pdt||"pp"==this.pdt?"http://blog.sohu.com/login/logon.do":null},getBaseInfoPath:function(){return"blog"==this.pdt?"http://blog.sohu.com/service/profile.jsp?detail=all":"http://blog.sohu.com/service/profile.jsp"},getHomePath:function(){return"http://blog.sohu.com/manage/main.do?tracker=toolbar"},getRequestPath:function(){return"http://blog.sohu.com/home/soRequest/inform.do"},getBlogPath:function(){return"function"==typeof getD&&getD()?"http://"+getD()+".blog.sohu.com":this.getXP()?"http://blog.sohu.com/people/!"+this.getXP():"http://blog.sohu.com/passport?auto=false&from=myblog"},getBlogWritePath:function(){return"http://blog.sohu.com/manage/entry.do?m=add&t=shortcut"},gotoBlogWrite:function(){window.open(isLogin()?this.getBlogWritePath():"http://blog.sohu.com/login/logon.do?bru="+encodeURIComponent(this.getBlogWritePath()),"_blank")},getBlogDataPath:function(){return"http://blog.sohu.com/service/profile.jsp?detail=all"},getPPPath:function(){return"http://pp.sohu.com/passport"},getPPNewSetPath:function(){return"http://pp.sohu.com/photoset.jhtml?m=add"},getPPUploadPath:function(){var t="http://pp.sohu.com/upload4tb.jhtml";"pp"!=this.pdt&&(t+="?ru=soPP"),t=this.getBlogPath()+"/album/upload4swf.jhtml?ru=soPP",this.photoControlWin=window.open(t),this.photoControlWin.focus()},getSlidePath:function(){window.open("http://pp.sohu.com/slide.jhtml?method=create","_blank")},getPPDataPath:function(){return"http://pp.sohu.com/photoparkService.jhtml?method=getUser&type=json"},getMusicPath:function(){return"http://mbox.sogou.com/mbox.so"},getVideoPath:function(){return"video"==this.pdt?"http://v.blog.sohu.com/people/"+this.getXP():"http://v.blog.sohu.com/passport"},getVideoUploadPath:function(){window.open("http://v.blog.sohu.com/s/normal?ru=soVideo","_blank")},getVideoRecordPath:function(){window.open("http://v.blog.sohu.com/s/rc?ru-soVideo","_blank")},getVideoDataPath:function(){return"http://v.blog.sohu.com/sblog.jhtml?m=camp"},getAlbumPath:function(){return"pp"==this.pdt?"http://pp.sohu.com/user/"+Role.id:"http://pp.sohu.com/passport"},getGroupPath:function(){return"http://q.sohu.com"},getMyGroupPath:function(){return"http://blog.sohu.com/home/soGroup/groups.do"},getGroupUserInfoPath:function(){return"http://q.sohu.com/passport"},getGroupWatchPath:function(){return"http://q.sohu.com/user/!"+this.getXP()+"/watchs"},getGroupDataPath:function(){return"http://q.sohu.com/page/user.do?action=camp"},getMsgPath:function(){return"http://me.sohu.com"},getMntWritePath:function(){return"http://mnf.blog.sohu.com/post"},getEditProfilePath:function(){return"http://blog.sohu.com/home/soProfile/basic.htm"},getEditIconPath:function(){return"http://blog.sohu.com/home/soProfile/uploadIcon.htm"},getBlogSettingPath:function(){return"http://blog.sohu.com/manage/setting.do"},getIntervalTime:function(t){if("undefine"==typeof t||!t)return"";var e=new Date,i=e.getTime()-t;if(6e4>=i)return"刚刚";var s=Math.floor(i/6e4),o=Math.floor(s/60),n=Math.floor(o/24),a="";return n>=1&&(a+=n,a+="天"),48>o&&o>0&&o%24>0&&(a+=o%24,a+="小时"),24>o&&s>0&&(a+=s%60,a+="分钟"),a+="前"},getLoader:function(){return'<div class="pst_loader">正在读取...</div>'},unescapeHTML:function(t){var e=document.createElement("div");return e.innerHTML=t.replace(/<\/?[^>]+>/gi,""),e.childNodes[0]?e.childNodes[0].nodeValue:""},Tip:function(t){this.showMoment=function(t){this.clearTimer(),this.showing||(this.show(),"number"!=typeof t&&(t=5e3),this.timerHide=setTimeout(function(){this.hide()}.bind(this),t))},this.closeMoment=function(){this.clearTimer();var e=t["data-tip-closeDelay"];e&&(e=parseInt(e)),setTimeout(this.close.bind(this),e||0)},this.close=function(){this.clearTimer(),this.showing&&(this.timer=setTimeout(function(){this.hide()}.bind(this),10))},this.clearTimer=function(){this.timer&&(clearTimeout(this.timer),this.timer=null),this.timerHide&&(clearTimeout(this.timerHide),this.timerHide=null)};var e;this.tipBox||(this.tipBox=document.createElement("div"),Element.hide(this.tipBox),$("toolBar").appendChild(this.tipBox),this.showing=!1,this.timerHide=null,Event.observe(t,"mouseover",this.showMoment.bind(this)),Event.observe(t,"mouseout",this.closeMoment.bindAsEventListener(this))),this.show=function(){var i="",s="",o="",n="";if((i=t["data-tip-title"])&&(s=t["data-tip-content"])&&(o=t["data-tip-ico"])?n=t["data-tip-icoAlt"]:(i=t.title||t.alt||t.tipsTitle,t.tipsTitle=i),t.title=t.alt="",s){var a='<table cellspacing="0" cellpadding="0" border="0" class="popMessage"><tbody><tr><td class="lt"></td><td class="mt"></td><td class="rt"></td></tr><tr><td class="lm"></td><td class="mm"><div class="mod"><div class="head clearfix"><h3></h3><div class="option"><a class="close" href="javascript:void(0);" onmousedown="CA.q(\'toolbar_request_close\')">关闭</a></div></div><div class="body clearfix"></div></div></td><td class="rm"></td></tr><tr><td class="lb"></td><td class="mb"></td><td class="rb"></td></tr></tbody></table>';
this.tipBox.className="",this.tipBox.style.position="absolute",this.tipBox.innerHTML=a;var l=this.tipBox.firstChild.rows[1].cells[1].firstChild;this.innerTipTitle=l.firstChild.firstChild,this.innerTipBox=l.lastChild,this.innerTipTitle.innerHTML='<img align="absmiddle" src="'+o+'" alt="'+n+'" />&nbsp;'+i,this.innerTipBox.innerHTML=s,Event.observe(l.firstChild.lastChild.firstChild,"click",this.close.bindAsEventListener(this))}else this.tipBox.className="tb_tipBox",this.tipBox.innerHTML='<div class="tb_innerTipBox"></div>',this.innerTipBox=this.tipBox.firstChild,this.innerTipBox.innerHTML=i;e=Position.cumulativeOffset(t),e=[e[0]-7+Math.floor(parseInt(t.offsetWidth)/2),e[1]+parseInt(t.offsetHeight)+4],this.tipBox.style.left=e[0]+"px",this.tipBox.style.top=e[1]+"px",0>Browser.ua.indexOf("ie")&&"undefined"!=typeof Effect&&Effect?Effect.Appear(this.tipBox,{from:0,to:.95,duration:.3,queue:{scope:"tip_"+e[0]+"_"+e[1],position:"end"}}):Element.show(this.tipBox),this.showing=!0},this.hide=function(){this.clearTimer(),this.tipBox&&(0>Browser.ua.indexOf("ie")&&"undefined"!=typeof Effect&&Effect?Effect.Fade(this.tipBox,{duration:.1,queue:{scope:"tip_"+e[0]+"_"+e[1],position:"end"}}):Element.hide(this.tipBox),this.showing=!1)}},needLogin:function(t,e){ToolBar.isLogin()?"string"==typeof e?location.href=e:location.reload():ToolBar.isPPLogin()?location.href=ToolBar.getLoginPath()+"?bru="+(e?e:location.href):(ToolBar.showLogin(e),ToolBar.loginBtn.blur())}};"undefined"!=typeof noToolBar&&noToolBar||ToolBar.init();var BlogPassportSC={appid:function(){return"group"==ToolBar.pdt||"blog"==ToolBar.pdt||"video"==ToolBar.pdt?1019:"pp"==ToolBar.pdt?1017:void 0}(),registerUrl:"http://blog.sohu.com/login/reg.do",loginRedirectUrl:location.href};"undefined"==typeof PassportSC||"undefined"!=typeof noRecoverPassportSC&&noRecoverPassportSC||(PassportSC=Object.extend(PassportSC,BlogPassportSC!==void 0?BlogPassportSC:{}));var Attr={value:function(t,e,i){return i!==void 0&&Attr.setValue(t,e,i),Attr.getValue(t,e)},getValue:function(t,e){return this["_get_"+e]?this["_get_"+e](t):$(t).getAttribute(e)},setValue:function(t,e,i){this["_set_"+e]?this["_set_"+e](t,i):$(t).setAttribute(e,i)},_get_value:function(t){return $(t).value},_set_value:function(t,e){var i=$(t);return i.value=e,i.value},_get_innerHTML:function(t){return $(t).innerHTML},_set_innerHTML:function(t,e){var i=$(t);return i.innerHTML=e,i.innerHTML},_get_innerText:function(t){var e=$(t),i="";return e&&(i="string"==typeof e.innerText?e.innerText:e.innerHTML.unescapeHTML())&&(i=i.replace(/\r|\n/gm,""))&&(i=i.trim())||(i=""),i},_set_innerText:function(t,e){var i=$(t);return i.innerHTML=e,i.innerHTML},data:function(t,e,i){return Attr.value(t,"data-"+e,i)},exp:function(t,e){return this.expContext(window,t,e)},_expVar:function(t,e,i){for(var s=e.split("."),o=t,n=i!==void 0,a=0,l=s.length;l>a;a++){if(n&&a==l-1)return o[s[a]]=i,"";if(o=o[s[a]],o===void 0||null==o)return null}return o},_expAttr:function(t,e,i){if(i!==void 0)return Attr.setValue(t,e,i),"";var s=Attr.getValue(t,e);return"string"==typeof s?s:""},expValue:function(t,e,i,s){var o=s!==void 0;return Attr._expReg||(Attr._expReg=/(^|[^\\])#\{([^\}<]+)(<\d+)?\}/g),i.replace(Attr._expReg,function(i,n,a,l){var r="",h=a.charAt(0);if(":"==h)return a.substr(1);switch(h){case"$":r=Attr._expVar(t,a.substr(1),s);break;case"#":var p=a.substr(1).split("@");r=Attr._expAttr(p[0],p[1],s);break;case"@":r=Attr._expAttr(e,a.substr(1),s);break;default:o||(r=Attr.expContext(t,e,a,s))}if(o)return"";if(null==r)r="";else if(r.length>0&&"string"==typeof l&&l.length>0){var d=parseInt(l.substr(1));r.length>=d&&(r=r.substr(0,d-1))}return n+r})},expContext:function(t,e,i){var s=Attr.data(e,i);if("string"!=typeof s||""==(s=s.trim()))return"";if(-1==s.indexOf("#{:=}"))return this.expValue(t,e,s);for(var o=s.split("#{:;}"),n=0,a=o.length;a>n;n++){var l=o[n].split("#{:=}");if(!(2>l.length)){var r=this.expValue(t,e,l.pop());this.expValue(t,e,l.join("#{:=}"),r)}}}},Shell={tip:'type "help" or "?" for help',rules:{help:[/^(help|\?)$/,function(){return Shell.showHelp(),Shell.initD(),!0}],clear:[/^(clear)$/,function(){Shell.cmdClear()}],passportCard:[/^(card|c)$/,function(){ToolBar.showStartMenu()}],passportCardContent:[/^(card|c)\s-\w{1,3}$/,function(t){ToolBar.startMenu&&ToolBar.startMenu.win.showing||ToolBar.showStartMenu();var e=t.substr(t.indexOf("-")+1);setTimeout(function(){"b"==e&&ToolBar.sm_activeMenu("blog"),"pp"==e&&ToolBar.sm_activeMenu("pp"),"v"==e&&ToolBar.sm_activeMenu("video"),"g"==e&&ToolBar.sm_activeMenu("group")},10)}],login:[/^(login)$/,function(){ToolBar.showLogin()}],logout:[/^(logout)$/,function(){ToolBar.doLogout()}],index:[/^(index)$/,function(){window.open("http://blog.sohu.com")}],groupIndex:[/^(group|g|forum|f)$/,function(){window.open("http://q.sohu.com/")}],forumOne:[/^(forum|f)\s-\d{1,2}$/,function(t){var e=t.split(/\s-/)[1],i="http://q.sohu.com/forum/"+e;"group"==ToolBar.pdt?location.href=i:window.open(i)}],groupOne:[/^(group|g)\s-\w{4,16}$/,function(t){var e=t.split(/\s-/)[1],i="http://"+e+".q.sohu.com/";"group"==ToolBar.pdt?location.href=i:window.open(i)}],groupProfile:[/^(group|g)\s-\w{1,3}$/,function(t){var e=t.substr(t.indexOf("-")+1);"p"==e&&window.open(ToolBar.getGroupUserInfoPath())}],groupPost:[/^(post|p)(\s-.+)*$/,function(t){if(_fid||_gid){var e=t.split(/\s-/),i="http://q.sohu.com/manage/topic.do?";_fid&&(i+="forumId="+_fid),_gid&&(i+="&groupId="+_gid),e[1]&&(i+="&title="+escape(e[1])),e[2]&&(i+="&tags="+escape(e[2])),window.open(i)}}],blog:[/^(blog|b)$/,function(){var t=ToolBar.getBlogPath();"blog"==ToolBar.pdt?location.href=t:window.open(t)}],blogOne:[/^(blog|b)\s-\w{4,16}$/,function(t){var e=t.split(/\s-/)[1],i="http://"+e+".blog.sohu.com/";"blog"==ToolBar.pdt?location.href=i:window.open(i)}],blogWrite:[/^(write|w)(\s-.+)*$/,function(t){var e=t.split(/\s-/),i=ToolBar.getBlogWritePath();e[1]&&(i+="&entrytitle="+escape(e[1])),e[2]&&(i+="&keywords="+escape(e[2])),window.open(i)}],pp:[/^(pp)$/,function(){var t=ToolBar.getPPPath();"pp"==ToolBar.pdt?location.href=t:window.open(t)}],ppOne:[/^(pp)\s-\w{4,16}$/,function(t){var e=t.split(/\s-/)[1],i="http://pp.sohu.com/member/"+e;"pp"==ToolBar.pdt?location.href=i:window.open(i)}],ppUpload:[/^(uploadpp|upp)$/,function(t){var e=t.substr(t.indexOf("-")+1);"pp"==e&&ToolBar.getPPUploadPath()}],music:[/^(music|m)$/,function(){window.open(ToolBar.getMusicPath())}],video:[/^(video|v)$/,function(){var t=ToolBar.getVideoPath();"pp"==ToolBar.pdt?location.href=t:window.open(t)}],videoUpload:[/^(upload|u)$/,function(){ToolBar.getVideoUploadPath()}],videoRecord:[/^(record|r)$/,function(){ToolBar.getVideoRecordPath()}],ing:[/^(ing)(\s-.+)*$/,function(t){var e=t.split(/\s-/);return e[1]?(Shell.mntAdd(e[1]),!0):void 0}]},build:function(){if($("toolBar")){this.box=document.createElement("div");var t="";t+='<div style="display:none;"></div>',t+="<div>",t+='<span style="font-size:26px;font-weight:bold;font-family:Arial;color:white;margin-right:5px;">&gt;</span>',t+="<input />",t+="</div>",t+='<div style="display:none;"></div>',this.box.innerHTML=t,this.infoBox=this.box.firstChild,this.inputBox=this.box.childNodes[1],this.ipt=this.inputBox.lastChild,this.loadBox=this.box.lastChild,Element.setStyle(this.box,{left:"100px",background:"#000",opacity:"0.8",filter:"alpha(opacity=80)",position:"absolute",zIndex:"999999999",padding:"10px",MozBorderRadius:"8px",display:"none",fontFamily:"Verdana, Arial, Helvetica, sans-serif"}),Element.setStyle(this.ipt,{fontSize:"30px",fontWeight:"bold",color:"#fff",fontFamily:'Monaco,"Courier New",simhei,Hei',border:"none",width:"95%",height:"30px",lineHeight:"30px",padding:"0",background:"transparent"}),document.body.appendChild(this.box),this.ipt.type="text",this.ipt.value=this.tip,Event.observe(window,"resize",this.initD.bindAsEventListener(this),!1),Event.observe(window,"scroll",this.initD.bindAsEventListener(this),!1),Event.observe(this.ipt,"keypress",this.typing.bindAsEventListener(this),!1),Event.observe(document,"keypress",this.showHide.bindAsEventListener(this),!1),this.initD(),this.cmdInit()}},showHide:function(t){return 27==t.keyCode?("none"==this.box.style.display?(this.box.style.display="block",""==this.ipt.value&&(this.ipt.value=""),this.ipt.focus()):this.hide(),!1):void 0},hide:function(){this.box.style.display="none",this.ipt.blur()},initD:function(){w=document.documentElement.clientWidth-200+"px",y=document.documentElement.scrollTop+(document.documentElement.clientHeight-this.box.offsetHeight)/2+"px",Element.setStyle(this.box,{top:y,width:w})},typing:function(t){if(27!=t.keycode){if(this.ipt.value!=this.tip&&13==t.keyCode){if(""==this.ipt.value)return this.box.style.display="none",this.ipt.blur(),void 0;this.cmdAdd(this.ipt.value);var e=this.ipt.value;if(this.ipt.value="",this.interpretor(e))return;this.hide()}38==t.keyCode&&(this.ipt.value=this.getCmdPre(this.ipt.value)),40==t.keyCode&&(this.ipt.value=this.getCmdAft(this.ipt.value)),this.ipt.value==this.tip&&(this.ipt.value="")}},interpretor:function(t){for(i in this.rules)if(t.match(this.rules[i][0]))return this.rules[i][1](t)},cmds:[],cmdLn:10,cmdI:10,cmdInit:function(){if(getCookie("cmd"))try{this.cmds=eval(getCookie("cmd"))}catch(e){}},cmdAdd:function(t){this.cmds.length>=this.cmdLn&&this.cmds.shift(),this.cmds.push(t),setCookie("cmd",this.cmds.inspect(),"never","/"),this.cmdI=this.cmdLn},cmdClear:function(){this.cmds=[],setCookie("cmd",this.cmds.inspect(),"never")},getCmdPre:function(){return this.cmdI--,this.cmdI=Math.max(0,Math.min(this.cmdI,this.cmds.length-1)),this.cmds[this.cmdI]||""},getCmdAft:function(){return this.cmdI++,this.cmdI=Math.max(0,Math.min(this.cmdI,this.cmds.length-1)),this.cmds[this.cmdI]||""},getHelp:function(){return str="",str+='<table border="0" style="color:white;">',str+='<tr><th width="150">命令</td><th>说明</td></tr>',str+="<tr><td>help|?</td><td>显示帮助</td></tr>",str+="<tr><td>card|c [-b|pp|v|g]</td><td>显示卡片</td></tr>",str+="<tr><td>login</td><td>显示登录框</td></tr>",str+="<tr><td>logout</td><td>离开</td></tr>",str+="<tr><td>index</td><td>搜狐博客首页</td></tr>",str+="<tr><td>forum|f [-id]</td><td>跳转广场</td></tr>",str+="<tr><td>group|g [-domain]</td><td>跳转到圈子</td></tr>",str+="<tr><td>group|g -p</td><td>个人档案</td></tr>",str+="<tr><td>blog|b [-domain]</td><td>跳转到博客</td></tr>",str+="<tr><td>pp [-domain]</td><td>跳转到相册</td></tr>",str+="<tr><td>music|m</td><td>跳转到音乐盒</td></tr>",str+="<tr><td>video|v</td><td>跳转到视频</td></tr>",str+="<tr><td>write|w	[-title [-tag]]</td><td>写博文</td></tr>",str+="<tr><td>post|p [-title [-tag]]</td><td>发新帖</td></tr>",str+="<tr><td>upload|u</td><td>上传视频</td></tr>",str+="<tr><td>record|r</td><td>录制视频</td></tr>",str+="<tr><td>uploadpp|upp</td><td>上传照片</td></tr>",str+="<tr><td>ing -text</td><td>正在做什么？</td></tr>",str+="</table>"},showHelp:function(){""==this.infoBox.innerHTML&&(this.infoBox.innerHTML=this.getHelp()),this.infoBox.style.display="none"==this.infoBox.style.display?"block":"none"},mntAdd:function(t){"undefined"!=typeof MiniBlog&&MiniBlog.newTalk_shell&&(MiniBlog.newTalk_shell=null),this.loadBox.innerHTML="loading...",Element.show(this.loadBox);var e=ToolBar.getMntWritePath();e+="?type=add&xpp="+ToolBar.getXP()+"&vn=shell&content="+escape(t),new LinkFile(e,{type:"script",callBack:{variable:"MiniBlog.newTalk_shell",onLoad:this.mntAddOk.bind(this),onFailure:this.mntAddFailure.bind(this)}})},mntAddOk:function(){return"1"!=MiniBlog.newTalk_shell.status?(this.mntAddFailure(),void 0):(this.loadBox.innerHTML="done.",setTimeout(function(){Element.hide(this.loadBox),this.hide()}.bind(this),1e3),void 0)},mntAddFailure:function(){var t="";t+="failure.","undefined"!=typeof MiniBlog&&MiniBlog.newTalk_shell&&MiniBlog.newTalk_shell.data&&(t+="&lt;"+MiniBlog.newTalk_shell.data+"&gt;"),this.loadBox.innerHTML=t,setTimeout(function(){Element.hide(this.loadBox)}.bind(this),2e3)}};"undefined"!=typeof noShell&&noShell||Event.observe(window,"load",Shell.build.bind(Shell),!1);var CA={init:function(){var t=document.createElement("img");t.id="caImg",t.style.display="none",document.body&&document.body.appendChild(t)},q:function(t){if($("caImg")){var e=[];e.push("t="+(new Date).getTime()),document.referrer&&e.push("r="+encodeURIComponent(document.referrer)),ToolBar.isPPLogin()&&e.push("xpt="+encodeURIComponent(ToolBar.getXP())),t&&e.push("from="+t);var i="http://bgt.blog.sohu.com/blogclick.gif?"+e.join("&");$("caImg").src=i}},a:function(t){if(!this.d){var e=document.domain.toLowerCase().split("."),i=e.length,s="";i>1&&"sohu"==(s=e[i-2])&&i>2&&"blog"==(s=e[i-3])&&i>3&&"v"==e[i-4]&&(s="v"),this.d=s+"_"}this.q(this.d+t)}};"undefined"!=typeof noClickAna&&noClickAna||Event.observe(window,"load",CA.init.bind(CA),!1);